# Change prefix key to Ctrl+Space
unbind C-b
set -g prefix C-Space
bind C-Space send-prefix

# Enable 2-line status bar (empty top line for taller clickable area)
set -g status 2
set -g status-format[0] '#[bg=default]'
set -g status-format[1] '#[align=left range=left #{E:status-left-style}]#[push-default]#{T;=/#{status-left-length}:status-left}#[pop-default]#[norange default]#[list=on align=#{status-justify}]#[list=left-marker]<#[list=right-marker]>#[list=on]#{W:#[range=window|#{window_index} #{E:window-status-style}#{?#{&&:#{window_last_flag},#{!=:#{E:window-status-last-style},default}}, #{E:window-status-last-style},}#{?#{&&:#{window_bell_flag},#{!=:#{E:window-status-bell-style},default}}, #{E:window-status-bell-style},#{?#{&&:#{||:#{window_activity_flag},#{window_silence_flag}},#{!=:#{E:window-status-activity-style},default}}, #{E:window-status-activity-style},}}]#[push-default]#{T:window-status-format}#[pop-default]#[norange default]#{?window_end_flag,,#{window-status-separator}},#[range=window|#{window_index} list=focus #{?#{!=:#{E:window-status-current-style},default},#{E:window-status-current-style},#{E:window-status-style}}#{?#{&&:#{window_last_flag},#{!=:#{E:window-status-last-style},default}}, #{E:window-status-last-style},}#{?#{&&:#{window_bell_flag},#{!=:#{E:window-status-bell-style},default}}, #{E:window-status-bell-style},#{?#{&&:#{||:#{window_activity_flag},#{window_silence_flag}},#{!=:#{E:window-status-activity-style},default}}, #{E:window-status-activity-style},}}]#[push-default]#{T:window-status-current-format}#[pop-default]#[norange default]#{?window_end_flag,,#{window-status-separator}}}#[nolist align=right range=right #{E:status-right-style}]#[push-default]#{T;=/#{status-right-length}:status-right}#[pop-default]#[norange default]'
set -g status-left-length 40

# Window status formatting with WorkMux agent status (ðŸ¤– working, ðŸ’¬ needs attention, âœ… done)
set -g window-status-format "(#W#{?@workmux_status, #{@workmux_status},})"
set -g window-status-current-format "(#W#{?@workmux_status, #{@workmux_status},})"

# Status bar colors - readable in both dark and light modes
set -g status-style "fg=default,bg=default"
set -g window-status-style "fg=default,bg=default"
set -g window-status-current-style "fg=colour254,bg=colour238,bold"

# Remove status-right (time/date on right side)
set -g status-right ""

# Toggle shell pane on/off with Ctrl+Space ; or just Ctrl+;
bind \; if-shell -F '#{==:#{window_panes},2}' 'kill-pane -t:.2' 'split-window -h'
bind -n C-\; if-shell -F '#{==:#{window_panes},2}' 'kill-pane -t:.2' 'split-window -h'

# Create new window with name prompt (Ctrl+t), same directory as current pane
bind -n C-t command-prompt -p "Window name:" "new-window -n '%%' -c '#{pane_current_path}'"

# Navigate between windows with Ctrl+Left and Ctrl+Right
bind -n C-Left select-window -p
bind -n C-Right select-window -n

# Terminal type and compatibility settings
set -g default-terminal "screen-256color"
set -g escape-time 10

# Enable mouse mode and copy to macOS clipboard on selection
set -g mouse on
set -g set-clipboard off

# Word selection includes dashes, underscores, etc. (only split on whitespace)
set -g word-separators " \t"
# Copy selection: exit copy mode if at bottom, stay if scrolled up
bind -T copy-mode MouseDragEnd1Pane if-shell -F "#{==:#{scroll_position},0}" \
    "send-keys -X copy-pipe-and-cancel \"sed 's/^[[:space:]]*//;s/[[:space:]]*$//' | pbcopy\"" \
    "send-keys -X copy-pipe \"sed 's/^[[:space:]]*//;s/[[:space:]]*$//' | pbcopy\""
bind -T copy-mode-vi MouseDragEnd1Pane if-shell -F "#{==:#{scroll_position},0}" \
    "send-keys -X copy-pipe-and-cancel \"sed 's/^[[:space:]]*//;s/[[:space:]]*$//' | pbcopy\"" \
    "send-keys -X copy-pipe \"sed 's/^[[:space:]]*//;s/[[:space:]]*$//' | pbcopy\""

# Enter copy mode with -e flag so scrolling to bottom exits copy mode
bind -T root MouseDrag1Pane if-shell -F "#{||:#{pane_in_mode},#{mouse_any_flag}}" "send-keys -M" "copy-mode -eM"

# Double-click to select and copy word (from normal mode - always exits since at bottom)
bind -T root DoubleClick1Pane select-pane -t = \; copy-mode \; send-keys -X select-word \; run-shell -d 0.15 \; send-keys -X copy-pipe-and-cancel "pbcopy"
# Double-click when already in copy mode (exit only if at bottom)
bind -T copy-mode DoubleClick1Pane send-keys -X select-word \; run-shell -d 0.15 \; if-shell -F "#{==:#{scroll_position},0}" \
    "send-keys -X copy-pipe-and-cancel 'pbcopy'" \
    "send-keys -X copy-pipe 'pbcopy'"
bind -T copy-mode-vi DoubleClick1Pane send-keys -X select-word \; run-shell -d 0.15 \; if-shell -F "#{==:#{scroll_position},0}" \
    "send-keys -X copy-pipe-and-cancel 'pbcopy'" \
    "send-keys -X copy-pipe 'pbcopy'"

# Triple-click to select and copy line (from normal mode - always exits since at bottom)
bind -T root TripleClick1Pane select-pane -t = \; copy-mode \; send-keys -X select-line \; run-shell -d 0.15 \; send-keys -X copy-pipe-and-cancel "pbcopy"
# Triple-click when already in copy mode (exit only if at bottom)
bind -T copy-mode TripleClick1Pane send-keys -X select-line \; run-shell -d 0.15 \; if-shell -F "#{==:#{scroll_position},0}" \
    "send-keys -X copy-pipe-and-cancel 'pbcopy'" \
    "send-keys -X copy-pipe 'pbcopy'"
bind -T copy-mode-vi TripleClick1Pane send-keys -X select-line \; run-shell -d 0.15 \; if-shell -F "#{==:#{scroll_position},0}" \
    "send-keys -X copy-pipe-and-cancel 'pbcopy'" \
    "send-keys -X copy-pipe 'pbcopy'"

# Scroll one line at a time for wheel
bind -T copy-mode-vi WheelUpPane send-keys -N 1 -X scroll-up
bind -T copy-mode-vi WheelDownPane send-keys -N 1 -X scroll-down
bind -T copy-mode WheelUpPane send-keys -N 1 -X scroll-up
bind -T copy-mode WheelDownPane send-keys -N 1 -X scroll-down

